# Test Manual - portal_security

**Generated**: 2025-08-28 00:58:06
**Theme Path**: `layer/themes/portal_security/`

## Overview

This manual documents all tests for the portal_security theme. It provides a comprehensive guide for understanding test coverage, test scenarios, and testing procedures.

## Theme Information

- **Type**: portal
- **Component**: security

## Test Structure

- **Unit Tests**: 16 files
- **Integration Tests**: 0 files
- **System Tests**: 0 files

## Test Documentation

### Unit Tests

## Test File: all-setup-coverage.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/all-setup-coverage.test.ts`

### Test Suites

- **All Setup Classes - Maximum Coverage**
- **StorySetup - Complete Methods**
- **DemoSetup - Complete Methods**

### Test Cases

#### should create story documentation

**Purpose**: This test verifies that should create story documentation

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create story structure

**Purpose**: This test verifies that should create story structure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create story package.json

**Purpose**: This test verifies that should create story package.json

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create development artifacts

**Purpose**: This test verifies that should create development artifacts

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create node project

**Purpose**: This test verifies that should create node project

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create python project

**Purpose**: This test verifies that should create python project

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create TypeScript config within createNodeProject

**Purpose**: This test verifies that should create TypeScript config within createNodeProject

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create README

**Purpose**: This test verifies that should create README

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create FEATURE.md

**Purpose**: This test verifies that should create FEATURE.md

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle deployment config with config file

**Purpose**: This test verifies that should handle deployment config with config file

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle Python language in createDeploymentConfig

**Purpose**: This test verifies that should handle Python language in createDeploymentConfig

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle JavaScript demo

**Purpose**: This test verifies that should handle JavaScript demo

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: base-setup-complete.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/base-setup-complete.test.ts`

### Test Suites

- **BaseSetup - Complete Coverage**
- **createPipeGateways error handling**
- **createDirectoryStructure error path**
- **createTaskQueue MD mode**
- **createMcpConfig**
- **createEnvFile error path**
- **run method - complete flow**
- **checkRequirements edge cases**
- **port checking**

### Test Cases

#### should handle pipe gateway creation error

**Purpose**: This test verifies that should handle pipe gateway creation error

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle directory creation error and return false

**Purpose**: This test verifies that should handle directory creation error and return false

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create MD format task queue

**Purpose**: This test verifies that should create MD format task queue

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should skip MCP config for MD mode

**Purpose**: This test verifies that should skip MCP config for MD mode

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create MCP config for VF mode

**Purpose**: This test verifies that should create MCP config for VF mode

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle env file write error

**Purpose**: This test verifies that should handle env file write error

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle deployment config failure

**Purpose**: This test verifies that should handle deployment config failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle env file creation failure

**Purpose**: This test verifies that should handle env file creation failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle task queue creation failure

**Purpose**: This test verifies that should handle task queue creation failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle MCP config creation failure

**Purpose**: This test verifies that should handle MCP config creation failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should warn when PostgreSQL is not available

**Purpose**: This test verifies that should warn when PostgreSQL is not available

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should fail when npm is not available

**Purpose**: This test verifies that should fail when npm is not available

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should detect port in use

**Purpose**: This test verifies that should detect port in use

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should detect port available

**Purpose**: This test verifies that should detect port available

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: base-setup.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/base-setup.test.ts`

### Test Suites

- **BaseSetup**
- **constructor**
- **getPortAllocation**
- **checkPortAvailability**
- **checkRequirements**
- **createDirectoryStructure**
- **createPipeGateways**
- **createEnvFile**
- **createTaskQueue**
- **createMcpConfig**
- **run**

### Test Cases

#### should initialize with correct properties

**Purpose**: This test verifies that should initialize with correct properties

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle skipDb option

**Purpose**: This test verifies that should handle skipDb option

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct port for demo deployment

**Purpose**: This test verifies that should return correct port for demo deployment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct port for production deployment

**Purpose**: This test verifies that should return correct port for production deployment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct port for agile deployments

**Purpose**: This test verifies that should return correct port for agile deployments

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct port for test deployment

**Purpose**: This test verifies that should return correct port for test deployment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return true when port is available

**Purpose**: This test verifies that should return true when port is available

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return false when port is in use

**Purpose**: This test verifies that should return false when port is in use

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return true when all requirements are met

**Purpose**: This test verifies that should return true when all requirements are met

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return false when node is not installed

**Purpose**: This test verifies that should return false when node is not installed

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return true even when PostgreSQL is not installed

**Purpose**: This test verifies that should return true even when PostgreSQL is not installed

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create all required directories

**Purpose**: This test verifies that should create all required directories

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return false on directory creation failure

**Purpose**: This test verifies that should return false on directory creation failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create pipe gateway files for all layers

**Purpose**: This test verifies that should create pipe gateway files for all layers

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create environment file with correct content

**Purpose**: This test verifies that should create environment file with correct content

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return false on file creation failure

**Purpose**: This test verifies that should return false on file creation failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create VF mode task queue

**Purpose**: This test verifies that should create VF mode task queue

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create MD mode task queue

**Purpose**: This test verifies that should create MD mode task queue

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle task queue creation failure

**Purpose**: This test verifies that should handle task queue creation failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create MCP configuration

**Purpose**: This test verifies that should create MCP configuration

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle MCP config creation failure

**Purpose**: This test verifies that should handle MCP config creation failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should run all setup steps successfully

**Purpose**: This test verifies that should run all setup steps successfully

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should stop if requirements check fails

**Purpose**: This test verifies that should stop if requirements check fails

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should stop if directory creation fails

**Purpose**: This test verifies that should stop if directory creation fails

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: theme-coverage.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/commands/theme-coverage.test.ts`

### Test Suites

- **Theme Command Coverage**

### Test Cases

#### should handle theme command with all options

**Purpose**: This test verifies that should handle theme command with all options

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle theme command with minimal options

**Purpose**: This test verifies that should handle theme command with minimal options

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: theme.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/commands/theme.test.ts`

### Test Suites

- **theme command**
- **command configuration**
- **action handler**

### Test Cases

#### should have correct command name and description

**Purpose**: This test verifies that should have correct command name and description

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should have correct arguments and options

**Purpose**: This test verifies that should have correct arguments and options

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create theme setup with default options

**Purpose**: This test verifies that should create theme setup with default options

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle custom options

**Purpose**: This test verifies that should handle custom options

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle setup failure

**Purpose**: This test verifies that should handle setup failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle setup error

**Purpose**: This test verifies that should handle setup error

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: demo-setup.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/demo-setup.test.ts`

### Test Suites

- **DemoSetup**
- **constructor**
- **getDeployDir**
- **getDbPassword**
- **getEnvConfig**
- **getPortAllocation**
- **createDeploymentConfig**
- **printSuccessMessage**

### Test Cases

#### should initialize with demo-specific properties

**Purpose**: This test verifies that should initialize with demo-specific properties

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should load config file when provided

**Purpose**: This test verifies that should load config file when provided

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle config file loading error

**Purpose**: This test verifies that should handle config file loading error

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct deployment directory path

**Purpose**: This test verifies that should return correct deployment directory path

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return demo-specific database password

**Purpose**: This test verifies that should return demo-specific database password

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate correct environment configuration

**Purpose**: This test verifies that should generate correct environment configuration

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct port for demo deployment

**Purpose**: This test verifies that should return correct port for demo deployment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should successfully create deployment configuration for TypeScript

**Purpose**: This test verifies that should successfully create deployment configuration for TypeScript

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create Python project for Python language

**Purpose**: This test verifies that should create Python project for Python language

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle errors during deployment config creation

**Purpose**: This test verifies that should handle errors during deployment config creation

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should print demo-specific success message

**Purpose**: This test verifies that should print demo-specific success message

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: mode.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/mode.test.ts`

### Test Suites

- **getMode**

### Test Cases

#### should return 

**Purpose**: This test verifies that should return 

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return 

**Purpose**: This test verifies that should return 

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return 

**Purpose**: This test verifies that should return 

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return 

**Purpose**: This test verifies that should return 

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return 

**Purpose**: This test verifies that should return 

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle other option properties correctly

**Purpose**: This test verifies that should handle other option properties correctly

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return 

**Purpose**: This test verifies that should return 

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: setup-classes-complete.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/setup-classes-complete.test.ts`

### Test Suites

- **Setup Classes - Complete Coverage**
- **StorySetup - Full Coverage**
- **DemoSetup - Full Coverage**
- **ThemeSetup - Error Cases**

### Test Cases

#### should run complete story setup

**Purpose**: This test verifies that should run complete story setup

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle story setup error

**Purpose**: This test verifies that should handle story setup error

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should run complete demo setup

**Purpose**: This test verifies that should run complete demo setup

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle Python demo setup

**Purpose**: This test verifies that should handle Python demo setup

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle theme creation with all errors

**Purpose**: This test verifies that should handle theme creation with all errors

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: story-setup.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/story-setup.test.ts`

### Test Suites

- **StorySetup**
- **constructor**
- **getDeployDir**
- **getDbPassword**
- **getEnvConfig**
- **getPortAllocation**
- **createDeploymentConfig**
- **printSuccessMessage**

### Test Cases

#### should initialize with story-specific properties

**Purpose**: This test verifies that should initialize with story-specific properties

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should use default values when optional properties not provided

**Purpose**: This test verifies that should use default values when optional properties not provided

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct deployment directory path

**Purpose**: This test verifies that should return correct deployment directory path

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return story-specific database password

**Purpose**: This test verifies that should return story-specific database password

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate correct environment configuration

**Purpose**: This test verifies that should generate correct environment configuration

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle missing parent references

**Purpose**: This test verifies that should handle missing parent references

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct port for story deployment

**Purpose**: This test verifies that should return correct port for story deployment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should successfully create deployment configuration

**Purpose**: This test verifies that should successfully create deployment configuration

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle errors during deployment config creation

**Purpose**: This test verifies that should handle errors during deployment config creation

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should print story-specific success message

**Purpose**: This test verifies that should print story-specific success message

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: theme-setup.test.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/unit/theme-setup.test.ts`

### Test Suites

- **ThemeSetup**
- **constructor**
- **getDeployDir**
- **getDbPassword**
- **getEnvConfig**
- **getPortAllocation**
- **createDeploymentConfig**
- **createThemeDocumentation**
- **createThemeStructure**
- **createThemePackageJson**
- **createStoryTemplates**
- **printSuccessMessage**

### Test Cases

#### should initialize with theme-specific properties

**Purpose**: This test verifies that should initialize with theme-specific properties

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate default description when not provided

**Purpose**: This test verifies that should generate default description when not provided

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle missing epicId

**Purpose**: This test verifies that should handle missing epicId

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct deployment directory path

**Purpose**: This test verifies that should return correct deployment directory path

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return theme-specific database password

**Purpose**: This test verifies that should return theme-specific database password

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate correct environment configuration with epic

**Purpose**: This test verifies that should generate correct environment configuration with epic

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle missing epic in env config

**Purpose**: This test verifies that should handle missing epic in env config

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return correct port for theme deployment

**Purpose**: This test verifies that should return correct port for theme deployment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should successfully create deployment configuration

**Purpose**: This test verifies that should successfully create deployment configuration

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle errors during deployment config creation

**Purpose**: This test verifies that should handle errors during deployment config creation

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create theme documentation files

**Purpose**: This test verifies that should create theme documentation files

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create theme directory structure

**Purpose**: This test verifies that should create theme directory structure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create theme-specific package.json

**Purpose**: This test verifies that should create theme-specific package.json

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create story template files

**Purpose**: This test verifies that should create story template files

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should print theme-specific success message

**Purpose**: This test verifies that should print theme-specific success message

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: AuthService.test.ts

**Path**: `layer/themes/portal_security/tests/unit/AuthService.test.ts`

### Test Suites

- **AuthService**
- **login**
- **logout**
- **validateToken**
- **getCurrentUser**
- **createUser**
- **Integration scenarios**

### Test Cases

#### should successfully authenticate valid user

**Purpose**: This test verifies that should successfully authenticate valid user

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should fail with invalid password

**Purpose**: This test verifies that should fail with invalid password

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should fail with non-existent user

**Purpose**: This test verifies that should fail with non-existent user

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should fail with missing credentials

**Purpose**: This test verifies that should fail with missing credentials

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate refresh token when remember me is enabled

**Purpose**: This test verifies that should generate refresh token when remember me is enabled

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create default admin in development mode

**Purpose**: This test verifies that should create default admin in development mode

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should destroy session on logout

**Purpose**: This test verifies that should destroy session on logout

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should validate and return user for valid token

**Purpose**: This test verifies that should validate and return user for valid token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for invalid token

**Purpose**: This test verifies that should return null for invalid token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for expired token

**Purpose**: This test verifies that should return null for expired token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should get user from session

**Purpose**: This test verifies that should get user from session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should get user from Bearer ${process.env.AUTH_TOKEN || 

**Purpose**: This test verifies that should get user from Bearer ${process.env.AUTH_TOKEN || 

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null when no auth is present

**Purpose**: This test verifies that should return null when no auth is present

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create user with hashed password

**Purpose**: This test verifies that should create user with hashed password

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create user with specified roles

**Purpose**: This test verifies that should create user with specified roles

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create user without email

**Purpose**: This test verifies that should create user without email

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle complete authentication flow

**Purpose**: This test verifies that should handle complete authentication flow

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update last login timestamp

**Purpose**: This test verifies that should update last login timestamp

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: CredentialStore.test.ts

**Path**: `layer/themes/portal_security/tests/unit/CredentialStore.test.ts`

### Test Suites

- **CredentialStore**
- **storeCredential**
- **getCredential**
- **deleteCredential**
- **getUserCredentials**
- **Shared Credentials**
- **Persistence**
- **Encryption**

### Test Cases

#### should store a password credential

**Purpose**: This test verifies that should store a password credential

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should store and encrypt API key credential

**Purpose**: This test verifies that should store and encrypt API key credential

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update existing credential

**Purpose**: This test verifies that should update existing credential

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle multiple credential types for same user

**Purpose**: This test verifies that should handle multiple credential types for same user

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for non-existent credential

**Purpose**: This test verifies that should return null for non-existent credential

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should decrypt encrypted credentials

**Purpose**: This test verifies that should decrypt encrypted credentials

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should delete an existing credential

**Purpose**: This test verifies that should delete an existing credential

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should not affect other credentials when deleting

**Purpose**: This test verifies that should not affect other credentials when deleting

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should list all credentials for a user without sensitive data

**Purpose**: This test verifies that should list all credentials for a user without sensitive data

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return empty array for user with no credentials

**Purpose**: This test verifies that should return empty array for user with no credentials

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should store and retrieve shared app credentials

**Purpose**: This test verifies that should store and retrieve shared app credentials

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should encrypt shared credentials

**Purpose**: This test verifies that should encrypt shared credentials

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for non-existent shared credentials

**Purpose**: This test verifies that should return null for non-existent shared credentials

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update shared credentials

**Purpose**: This test verifies that should update shared credentials

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should persist credentials across instances

**Purpose**: This test verifies that should persist credentials across instances

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle corrupted storage gracefully

**Purpose**: This test verifies that should handle corrupted storage gracefully

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should use different encryption for different keys

**Purpose**: This test verifies that should use different encryption for different keys

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should fail to decrypt with wrong key

**Purpose**: This test verifies that should fail to decrypt with wrong key

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: CrossDomainSessionManager.test.ts

**Path**: `layer/themes/portal_security/tests/unit/CrossDomainSessionManager.test.ts`

### Test Suites

- **CrossDomainSessionManager**
- **createCrossDomainSession**
- **getSession**
- **updateSession**
- **destroySession**
- **Cross-domain token validation**
- **Session synchronization**
- **RedisSessionStorage**
- **Middleware**

### Test Cases

#### should create a session accessible across domains

**Purpose**: This test verifies that should create a session accessible across domains

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should emit sessionCreated event

**Purpose**: This test verifies that should emit sessionCreated event

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should track user sessions

**Purpose**: This test verifies that should track user sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should retrieve session with domain validation

**Purpose**: This test verifies that should retrieve session with domain validation

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should reject invalid domain access

**Purpose**: This test verifies that should reject invalid domain access

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update lastAccessedAt on retrieval

**Purpose**: This test verifies that should update lastAccessedAt on retrieval

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update session across domains

**Purpose**: This test verifies that should update session across domains

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should broadcast update to other domains

**Purpose**: This test verifies that should broadcast update to other domains

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should destroy session across all domains

**Purpose**: This test verifies that should destroy session across all domains

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should emit sessionDestroyed event

**Purpose**: This test verifies that should emit sessionDestroyed event

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should untrack user sessions on destroy

**Purpose**: This test verifies that should untrack user sessions on destroy

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate valid cross-domain token

**Purpose**: This test verifies that should generate valid cross-domain token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should validate cross-domain token

**Purpose**: This test verifies that should validate cross-domain token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should reject invalid tokens

**Purpose**: This test verifies that should reject invalid tokens

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle session sync messages

**Purpose**: This test verifies that should handle session sync messages

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should sync sessions periodically

**Purpose**: This test verifies that should sync sessions periodically

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should store and retrieve sessions

**Purpose**: This test verifies that should store and retrieve sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should delete sessions

**Purpose**: This test verifies that should delete sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should cleanup expired sessions

**Purpose**: This test verifies that should cleanup expired sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should support pub/sub for synchronization

**Purpose**: This test verifies that should support pub/sub for synchronization

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create Express middleware

**Purpose**: This test verifies that should create Express middleware

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle cross-domain tokens in middleware

**Purpose**: This test verifies that should handle cross-domain tokens in middleware

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should set CORS headers for valid domains

**Purpose**: This test verifies that should set CORS headers for valid domains

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: SecurityMiddlewareSuite.test.ts

**Path**: `layer/themes/portal_security/tests/unit/SecurityMiddlewareSuite.test.ts`

### Test Suites

- **SecurityMiddlewareSuite**
- **requireAuth middleware**
- **requireRole middleware**
- **rateLimit middleware**
- **cors middleware**
- **csrfProtection middleware**
- **xssProtection middleware**
- **sqlInjectionProtection middleware**
- **auditLog middleware**
- **getAllMiddleware integration**

### Test Cases

#### should block unauthenticated access to protected routes

**Purpose**: This test verifies that should block unauthenticated access to protected routes

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allow access to public paths

**Purpose**: This test verifies that should allow access to public paths

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allow authenticated users

**Purpose**: This test verifies that should allow authenticated users

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should redirect to login path for HTML requests

**Purpose**: This test verifies that should redirect to login path for HTML requests

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should block users without required role

**Purpose**: This test verifies that should block users without required role

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allow users with required role

**Purpose**: This test verifies that should allow users with required role

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allow requests within limit

**Purpose**: This test verifies that should allow requests within limit

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should block requests exceeding limit

**Purpose**: This test verifies that should block requests exceeding limit

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should reset after window expires

**Purpose**: This test verifies that should reset after window expires

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should add CORS headers for allowed origins

**Purpose**: This test verifies that should add CORS headers for allowed origins

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should not add CORS headers for disallowed origins

**Purpose**: This test verifies that should not add CORS headers for disallowed origins

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle preflight requests

**Purpose**: This test verifies that should handle preflight requests

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate CSRF token on GET request

**Purpose**: This test verifies that should generate CSRF token on GET request

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should block POST without CSRF token

**Purpose**: This test verifies that should block POST without CSRF token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allow POST with valid CSRF token

**Purpose**: This test verifies that should allow POST with valid CSRF token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should sanitize XSS attempts in request body

**Purpose**: This test verifies that should sanitize XSS attempts in request body

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should add XSS protection headers

**Purpose**: This test verifies that should add XSS protection headers

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should block SQL injection attempts

**Purpose**: This test verifies that should block SQL injection attempts

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allow normal queries

**Purpose**: This test verifies that should allow normal queries

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should detect UNION attacks

**Purpose**: This test verifies that should detect UNION attacks

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should log successful requests

**Purpose**: This test verifies that should log successful requests

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should log authentication failures

**Purpose**: This test verifies that should log authentication failures

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should sanitize sensitive data in logs

**Purpose**: This test verifies that should sanitize sensitive data in logs

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return all configured middleware

**Purpose**: This test verifies that should return all configured middleware

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should apply all middleware to Express app

**Purpose**: This test verifies that should apply all middleware to Express app

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: SessionManager.test.ts

**Path**: `layer/themes/portal_security/tests/unit/SessionManager.test.ts`

### Test Suites

- **SessionManager**
- **createSession**
- **getSession**
- **updateSession**
- **destroySession**
- **extendSession**
- **getUserSessions**
- **cleanupExpiredSessions**
- **Concurrency scenarios**

### Test Cases

#### should create a new session

**Purpose**: This test verifies that should create a new session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should set creation and update timestamps

**Purpose**: This test verifies that should set creation and update timestamps

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should store session data correctly

**Purpose**: This test verifies that should store session data correctly

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should retrieve existing session

**Purpose**: This test verifies that should retrieve existing session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for non-existent session

**Purpose**: This test verifies that should return null for non-existent session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for expired session

**Purpose**: This test verifies that should return null for expired session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update lastAccessedAt on retrieval

**Purpose**: This test verifies that should update lastAccessedAt on retrieval

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update session data

**Purpose**: This test verifies that should update session data

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update updatedAt timestamp

**Purpose**: This test verifies that should update updatedAt timestamp

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null when updating non-existent session

**Purpose**: This test verifies that should return null when updating non-existent session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should not update expired session

**Purpose**: This test verifies that should not update expired session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should remove session

**Purpose**: This test verifies that should remove session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle destroying non-existent session

**Purpose**: This test verifies that should handle destroying non-existent session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should extend session expiry

**Purpose**: This test verifies that should extend session expiry

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null when extending non-existent session

**Purpose**: This test verifies that should return null when extending non-existent session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should not extend already expired session

**Purpose**: This test verifies that should not extend already expired session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should get all sessions for a user

**Purpose**: This test verifies that should get all sessions for a user

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should not return expired sessions

**Purpose**: This test verifies that should not return expired sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return empty array for user with no sessions

**Purpose**: This test verifies that should return empty array for user with no sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should remove expired sessions

**Purpose**: This test verifies that should remove expired sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return 0 when no expired sessions

**Purpose**: This test verifies that should return 0 when no expired sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle concurrent session creation

**Purpose**: This test verifies that should handle concurrent session creation

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle concurrent operations on same session

**Purpose**: This test verifies that should handle concurrent operations on same session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: TokenService.test.ts

**Path**: `layer/themes/portal_security/tests/unit/TokenService.test.ts`

### Test Suites

- **TokenService**
- **generateToken**
- **generateRefreshToken**
- **verifyToken**
- **refreshToken**
- **getTokenExpiry**
- **Security scenarios**

### Test Cases

#### should generate a valid JWT token

**Purpose**: This test verifies that should generate a valid JWT token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate token with custom expiry

**Purpose**: This test verifies that should generate token with custom expiry

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should include all payload fields in token

**Purpose**: This test verifies that should include all payload fields in token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate a valid refresh token

**Purpose**: This test verifies that should generate a valid refresh token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should have longer expiry than regular token

**Purpose**: This test verifies that should have longer expiry than regular token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should include refresh type in token

**Purpose**: This test verifies that should include refresh type in token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should verify and decode valid token

**Purpose**: This test verifies that should verify and decode valid token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for invalid token

**Purpose**: This test verifies that should return null for invalid token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for expired token

**Purpose**: This test verifies that should return null for expired token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should verify refresh token

**Purpose**: This test verifies that should verify refresh token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate new token from valid refresh token

**Purpose**: This test verifies that should generate new token from valid refresh token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for non-refresh token

**Purpose**: This test verifies that should return null for non-refresh token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for invalid refresh token

**Purpose**: This test verifies that should return null for invalid refresh token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for expired refresh token

**Purpose**: This test verifies that should return null for expired refresh token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should get expiry time from token

**Purpose**: This test verifies that should get expiry time from token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for invalid token

**Purpose**: This test verifies that should return null for invalid token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should return null for token without expiry

**Purpose**: This test verifies that should return null for token without expiry

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should use different secrets for different token types

**Purpose**: This test verifies that should use different secrets for different token types

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle concurrent token generation

**Purpose**: This test verifies that should handle concurrent token generation

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

### Integration Tests

## Test File: base-setup-real.itest.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/integration/base-setup-real.itest.ts`

### Test Suites

- **BaseSetup - Mock Free Tests**
- **Real Port Availability Check**
- **Real Directory Structure Creation**
- **Real Environment File Creation**
- **Real Task Queue Creation**
- **Real Requirements Check**
- **Full Real Setup Run**

### Test Cases

#### should correctly identify available port

**Purpose**: This test verifies that should correctly identify available port

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should correctly identify occupied port

**Purpose**: This test verifies that should correctly identify occupied port

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create actual directory structure

**Purpose**: This test verifies that should create actual directory structure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create actual .env file with real content

**Purpose**: This test verifies that should create actual .env file with real content

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create actual TASK_QUEUE.vf.json file

**Purpose**: This test verifies that should create actual TASK_QUEUE.vf.json file

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should create actual TASK_QUEUE.md file for md mode

**Purpose**: This test verifies that should create actual TASK_QUEUE.md file for md mode

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should check actual system requirements

**Purpose**: This test verifies that should check actual system requirements

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should complete entire setup with real operations

**Purpose**: This test verifies that should complete entire setup with real operations

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: setup-workflow.itest.ts

**Path**: `layer/themes/portal_security/layer/themes/setup-folder/tests/integration/setup-workflow.itest.ts`

### Test Suites

- **Setup Workflow Integration**
- **Theme Setup Workflow**
- **Multi-Level Setup Workflow**
- **Port Allocation Integration**
- **Error Handling Integration**

### Test Cases

#### should create complete theme structure

**Purpose**: This test verifies that should create complete theme structure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should support epic->theme->story hierarchy

**Purpose**: This test verifies that should support epic->theme->story hierarchy

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allocate different ports for different deployment types

**Purpose**: This test verifies that should allocate different ports for different deployment types

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle filesystem errors gracefully

**Purpose**: This test verifies that should handle filesystem errors gracefully

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should rollback on partial failure

**Purpose**: This test verifies that should rollback on partial failure

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: auth-flow.itest.ts

**Path**: `layer/themes/portal_security/tests/integration/auth-flow.itest.ts`

### Test Suites

- **Authentication Flow Integration**
- **Complete Authentication Flow**
- **Security Scenarios**

### Test Cases

#### should handle full user lifecycle

**Purpose**: This test verifies that should handle full user lifecycle

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle role-based access control

**Purpose**: This test verifies that should handle role-based access control

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle invalid authentication attempts

**Purpose**: This test verifies that should handle invalid authentication attempts

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle session expiration

**Purpose**: This test verifies that should handle session expiration

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle remember me functionality

**Purpose**: This test verifies that should handle remember me functionality

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle concurrent sessions for same user

**Purpose**: This test verifies that should handle concurrent sessions for same user

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allow public routes without authentication

**Purpose**: This test verifies that should allow public routes without authentication

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle session cleanup

**Purpose**: This test verifies that should handle session cleanup

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should prevent CSRF attacks

**Purpose**: This test verifies that should prevent CSRF attacks

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle rate limiting scenarios

**Purpose**: This test verifies that should handle rate limiting scenarios

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: auth-real.itest.ts

**Path**: `layer/themes/portal_security/tests/integration/auth-real.itest.ts`

### Test Suites

- **Portal Security - Real Authentication Tests**
- **Real Login Flow**
- **Real Token Authentication**
- **Real Logout Flow**
- **Real Concurrent Sessions**
- **Real Session Expiry**
- **Real Database Integrity**

### Test Cases

#### should successfully login with valid credentials

**Purpose**: This test verifies that should successfully login with valid credentials

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should reject invalid password

**Purpose**: This test verifies that should reject invalid password

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should reject non-existent user

**Purpose**: This test verifies that should reject non-existent user

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should require both username and password

**Purpose**: This test verifies that should require both username and password

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should access protected endpoint with valid token

**Purpose**: This test verifies that should access protected endpoint with valid token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should get user details with valid token

**Purpose**: This test verifies that should get user details with valid token

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should successfully logout and invalidate session

**Purpose**: This test verifies that should successfully logout and invalidate session

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle multiple users logging in simultaneously

**Purpose**: This test verifies that should handle multiple users logging in simultaneously

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should reject expired sessions

**Purpose**: This test verifies that should reject expired sessions

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should maintain referential integrity

**Purpose**: This test verifies that should maintain referential integrity

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should cascade delete sessions when user is deleted

**Purpose**: This test verifies that should cascade delete sessions when user is deleted

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: configmanager-envgenerator.itest.ts

**Path**: `layer/themes/portal_security/tests/integration/configmanager-envgenerator.itest.ts`

### Test Suites

- **ConfigManager integrates with EnvGenerator**
- **Port Allocation Integration**
- **Database Configuration Integration**
- **Security Configuration Integration**
- **Service Configuration Integration**
- **Configuration Updates**
- **Configuration Propagation**
- **Configuration Validation**
- **Complete Integration**

### Test Cases

#### should include port allocations from ConfigManager in .env file

**Purpose**: This test verifies that should include port allocations from ConfigManager in .env file

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should allocate new ports for dynamic services

**Purpose**: This test verifies that should allocate new ports for dynamic services

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle port allocations for different environments

**Purpose**: This test verifies that should handle port allocations for different environments

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should use SQLite for development and test environments

**Purpose**: This test verifies that should use SQLite for development and test environments

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should use PostgreSQL for release environment

**Purpose**: This test verifies that should use PostgreSQL for release environment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should get database config from ConfigManager

**Purpose**: This test verifies that should get database config from ConfigManager

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should apply security settings from ConfigManager

**Purpose**: This test verifies that should apply security settings from ConfigManager

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should have different security settings per environment

**Purpose**: This test verifies that should have different security settings per environment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should include all enabled services from ConfigManager

**Purpose**: This test verifies that should include all enabled services from ConfigManager

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle service dependencies from ConfigManager

**Purpose**: This test verifies that should handle service dependencies from ConfigManager

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should reflect ConfigManager updates in generated env files

**Purpose**: This test verifies that should reflect ConfigManager updates in generated env files

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle feature flag updates

**Purpose**: This test verifies that should handle feature flag updates

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should propagate configuration changes across environments

**Purpose**: This test verifies that should propagate configuration changes across environments

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should validate configuration before generating env file

**Purpose**: This test verifies that should validate configuration before generating env file

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate complete env file using all ConfigManager features

**Purpose**: This test verifies that should generate complete env file using all ConfigManager features

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: envgenerator-servicediscovery.itest.ts

**Path**: `layer/themes/portal_security/tests/integration/envgenerator-servicediscovery.itest.ts`

### Test Suites

- **EnvGenerator integrates with ServiceDiscovery**
- **Service URL Discovery**
- **Auto-Discovery Integration**
- **Service Health Integration**
- **Theme Dependencies Discovery**
- **Multiple Environments**
- **Service Metadata**

### Test Cases

#### should include discovered service URLs in .env file

**Purpose**: This test verifies that should include discovered service URLs in .env file

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle services with dependencies

**Purpose**: This test verifies that should handle services with dependencies

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should use correct protocol for different environments

**Purpose**: This test verifies that should use correct protocol for different environments

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should auto-discover services from ConfigManager

**Purpose**: This test verifies that should auto-discover services from ConfigManager

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should include base URLs for the environment

**Purpose**: This test verifies that should include base URLs for the environment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should check service health when including URLs

**Purpose**: This test verifies that should check service health when including URLs

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should discover services from theme dependencies

**Purpose**: This test verifies that should discover services from theme dependencies

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should maintain separate service registrations per environment

**Purpose**: This test verifies that should maintain separate service registrations per environment

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle services with metadata

**Purpose**: This test verifies that should handle services with metadata

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

## Test File: envgenerator-tokenservice.itest.ts

**Path**: `layer/themes/portal_security/tests/integration/envgenerator-tokenservice.itest.ts`

### Test Suites

- **EnvGenerator integrates with TokenService**
- **Security Token Generation**
- **TokenService Integration**
- **Complete Environment Generation**
- **Error Handling**
- **Security Best Practices**

### Test Cases

#### should generate .env file with JWT secrets from TokenService

**Purpose**: This test verifies that should generate .env file with JWT secrets from TokenService

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate session secrets using TokenService

**Purpose**: This test verifies that should generate session secrets using TokenService

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate environment-specific security tokens

**Purpose**: This test verifies that should generate environment-specific security tokens

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should use TokenService.generateSecret for creating JWT secrets

**Purpose**: This test verifies that should use TokenService.generateSecret for creating JWT secrets

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should validate generated tokens can be used by TokenService

**Purpose**: This test verifies that should validate generated tokens can be used by TokenService

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should generate complete .env file with all security configurations

**Purpose**: This test verifies that should generate complete .env file with all security configurations

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should update existing .env file with new security tokens

**Purpose**: This test verifies that should update existing .env file with new security tokens

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should handle TokenService errors gracefully

**Purpose**: This test verifies that should handle TokenService errors gracefully

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should set secure flags appropriately for different environments

**Purpose**: This test verifies that should set secure flags appropriately for different environments

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

#### should use different session timeouts for different environments

**Purpose**: This test verifies that should use different session timeouts for different environments

**Steps**:
1. Setup test environment
2. Execute test scenario
3. Verify expected outcome
4. Cleanup test data

---

### System Tests


## Testing Procedures

### Environment Setup

1. Install dependencies: `npm install`
2. Configure environment variables
3. Initialize test database (if applicable)
4. Start required services

### Running Tests

```bash
# Run all tests
npm test

# Run unit tests only
npm run test:unit

# Run integration tests
npm run test:integration

# Run system tests
npm run test:system

# Run with coverage
npm run test:coverage
```

### Test Data Management

- Test data location: `tests/fixtures/`
- Mock data: `tests/mocks/`
- Test configuration: `tests/config/`

### Continuous Integration

Tests are automatically run on:
- Pull request creation
- Push to main branch
- Nightly builds

## Coverage Requirements

- **Unit Test Coverage**: Minimum 90%
- **Integration Test Coverage**: Minimum 80%
- **System Test Coverage**: Critical paths only

## Troubleshooting

### Common Issues

1. **Test Timeout**
   - Increase timeout in test configuration
   - Check network connectivity
   - Verify service availability

2. **Test Data Issues**
   - Reset test database
   - Clear test cache
   - Regenerate fixtures

3. **Environment Issues**
   - Verify environment variables
   - Check service configurations
   - Review dependency versions

---
*Generated by test-as-manual documentation system*
