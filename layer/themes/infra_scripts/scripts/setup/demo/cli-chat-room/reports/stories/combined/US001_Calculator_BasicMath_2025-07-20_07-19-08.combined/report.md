# Story Report: US001_Calculator_BasicMath

**Generated:** 7/20/2025, 7:19:08 AM

## Status: ‚ùå WARNING

## Summary

Story US001_Calculator_BasicMath: Code quality analysis In Progress. Duplication: 51.77% (exceeds 5% threshold)

## ‚ùå Failure Reasons

- Code duplication 51.77% exceeds 5% threshold

## üìä Coverage Report

### Overall Coverage

| Metric | Coverage |
|--------|----------|
| Statements | 85.5% |
| Branches | 83.5% |
| Functions | 88.5% |
| Lines | 85.5% |

## üß™ System Tests

**Total Tests:** 1
**IN PROGRESS:** 1
**Failed:** 0

### Test Details:

| Test Name | Status | Coverage | Duration |
|-----------|--------|----------|----------|
| test_US001_SD001_code_quality | üîÑ IN PROGRESS | 85% | 150ms |

## üîç Code Duplication Analysis

> **Note**: Analyzes code duplication across the codebase to maintain code quality.

| Metric | Value | Status |
|--------|-------|--------|
| Total Lines | 12883 | - |
| Duplicate Lines | 6670 | - |
| Duplication % | 51.77% | ‚ùå Fail |
| Threshold | 5% | - |
| Duplicate Instances | 618 | - |

### Top Duplications

#### 1. Function Duplication

Found in 2 locations:
- `src/server/chat-server.ts:35-58` (setupWebSocketServer)
- `src/server/enhanced-chat-server.ts:98-121` (setupWebSocketServer)

#### 2. Code Block Duplication

Found in 6 locations:
- `src/agents/enhanced-story-reporter.ts:633-637` (lines 633-637)
- `src/agents/enhanced-story-reporter.ts:634-638` (lines 634-638)
- `src/agents/external-api-monitor.ts:396-400` (lines 396-400)
- `src/agents/external-api-monitor.ts:397-401` (lines 397-401)
- `src/agents/story-reporter.ts:249-253` (lines 249-253)
- `src/agents/story-reporter.ts:250-254` (lines 250-254)

#### 3. Function Duplication

Found in 2 locations:
- `src/server/chat-server.ts:385-397` (broadcastToRoom)
- `src/server/enhanced-chat-server.ts:426-438` (broadcastToRoom)

#### 4. Code Block Duplication

Found in 5 locations:
- `src/agents/enhanced-story-reporter.ts:157-161` (lines 157-161)
- `src/agents/environment-monitor.ts:76-80` (lines 76-80)
- `src/agents/external-api-monitor.ts:81-85` (lines 81-85)
- `src/agents/fraud-checker.ts:105-109` (lines 105-109)
- `src/agents/story-reporter.ts:62-66` (lines 62-66)

#### 5. Code Block Duplication

Found in 5 locations:
- `src/agents/enhanced-story-reporter.ts:603-607` (lines 603-607)
- `src/agents/enhanced-story-reporter.ts:623-627` (lines 623-627)
- `src/agents/external-api-monitor.ts:245-249` (lines 245-249)
- `src/agents/external-api-monitor.ts:342-346` (lines 342-346)
- `src/agents/external-api-monitor.ts:377-381` (lines 377-381)

*... and 613 more duplications*

### ‚ö†Ô∏è Action Required

The duplication percentage (51.77%) exceeds the threshold (5%). Please refactor the duplicate code to improve maintainability.

---

*Report generated by Enhanced Story Reporter*
*Room ID: duplication-demo*
